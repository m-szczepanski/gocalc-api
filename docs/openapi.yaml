openapi: 3.0.3
info:
  title: gocalc-api
  version: 1.0.0
  description: |
    A stateless HTTP API for performing various calculations including mathematical operations,
    financial computations, and utility-based calculations.
    
    This API is designed to be simple, fast, and scalable with no database or session management.
    Every request contains all the information required to perform a calculation.
    
  contact:
    name: gocalc-api
    url: https://github.com/mateusz/gocalc-api

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Health
    description: Service health check endpoint
  - name: Math Operations
    description: Basic mathematical calculations
  - name: Finance Calculations
    description: Financial computations including VAT, interest, and loan payments
  - name: Utility Calculations
    description: Utility calculations including BMI and unit conversions

paths:
  /health:
    get:
      summary: Health check
      description: Returns the health status of the API. This endpoint accepts any HTTP method.
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /api/math/add:
    post:
      summary: Add two numbers
      description: Performs addition of two numbers (a + b)
      operationId: mathAdd
      tags:
        - Math Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MathRequest'
            examples:
              basic:
                summary: Basic addition
                value:
                  a: 10.5
                  b: 5.3
              negative:
                summary: Addition with negative number
                value:
                  a: -15.2
                  b: 8.7
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MathResponseWrapper'
              examples:
                basic:
                  summary: Basic addition result
                  value:
                    data:
                      result: 15.8
                    request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
                    timestamp: "2026-01-29T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/math/subtract:
    post:
      summary: Subtract two numbers
      description: Performs subtraction of two numbers (a - b)
      operationId: mathSubtract
      tags:
        - Math Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MathRequest'
            examples:
              basic:
                summary: Basic subtraction
                value:
                  a: 20.0
                  b: 8.5
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MathResponseWrapper'
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/math/multiply:
    post:
      summary: Multiply two numbers
      description: Performs multiplication of two numbers (a * b)
      operationId: mathMultiply
      tags:
        - Math Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MathRequest'
            examples:
              basic:
                summary: Basic multiplication
                value:
                  a: 4.5
                  b: 3.0
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MathResponseWrapper'
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/math/divide:
    post:
      summary: Divide two numbers
      description: |
        Performs division of two numbers (a / b).
        Returns an error if b is zero (division by zero).
      operationId: mathDivide
      tags:
        - Math Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MathRequest'
            examples:
              basic:
                summary: Basic division
                value:
                  a: 15.0
                  b: 3.0
              divisionByZero:
                summary: Division by zero (error case)
                value:
                  a: 10.0
                  b: 0.0
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MathResponseWrapper'
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/finance/vat:
    post:
      summary: Calculate VAT
      description: |
        Calculates VAT (Value Added Tax) for a given amount.
        - If inclusive=true: Extracts VAT from a gross amount
        - If inclusive=false: Adds VAT to a net amount
      operationId: calculateVAT
      tags:
        - Finance Calculations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VATRequest'
            examples:
              addVAT:
                summary: Add VAT to net amount
                value:
                  amount: 100.0
                  rate: 23.0
                  inclusive: false
              extractVAT:
                summary: Extract VAT from gross amount
                value:
                  amount: 123.0
                  rate: 23.0
                  inclusive: true
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VATResponseWrapper'
              examples:
                addVAT:
                  summary: VAT added
                  value:
                    data:
                      vat_amount: 23.0
                      net_amount: 100.0
                      gross_amount: 123.0
                    request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
                    timestamp: "2026-01-29T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/finance/compound-interest:
    post:
      summary: Calculate compound interest
      description: |
        Calculates compound interest using the formula: A = P * (1 + r/n)^(n*t)
        where:
        - P = principal (initial amount)
        - r = annual interest rate (as decimal)
        - n = compound frequency (times per year)
        - t = time (in years)
      operationId: calculateCompoundInterest
      tags:
        - Finance Calculations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompoundInterestRequest'
            examples:
              monthly:
                summary: Monthly compounding
                value:
                  principal: 1000.0
                  rate: 5.0
                  time: 2.0
                  compound_frequency: 12
              annual:
                summary: Annual compounding
                value:
                  principal: 5000.0
                  rate: 3.5
                  time: 10.0
                  compound_frequency: 1
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompoundInterestResponseWrapper'
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/finance/loan-payment:
    post:
      summary: Calculate loan payment
      description: |
        Calculates periodic loan payment amount using standard amortization formula.
        Useful for mortgages, car loans, or any fixed-payment loan.
      operationId: calculateLoanPayment
      tags:
        - Finance Calculations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoanPaymentRequest'
            examples:
              mortgage:
                summary: 30-year mortgage with monthly payments
                value:
                  principal: 200000.0
                  annual_rate: 3.5
                  years: 30.0
                  payments_per_year: 12
              carLoan:
                summary: 5-year car loan
                value:
                  principal: 25000.0
                  annual_rate: 4.2
                  years: 5.0
                  payments_per_year: 12
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanPaymentResponseWrapper'
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/utils/bmi:
    post:
      summary: Calculate BMI
      description: |
        Calculates Body Mass Index (BMI) and categorizes the result.
        Supports multiple weight and height units with automatic conversion.
      operationId: calculateBMI
      tags:
        - Utility Calculations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BMIRequest'
            examples:
              metric:
                summary: Using metric units
                value:
                  weight: 70.0
                  weight_unit: kg
                  height: 1.75
                  height_unit: m
              imperial:
                summary: Using imperial units
                value:
                  weight: 154.0
                  weight_unit: lb
                  height: 68.0
                  height_unit: in
      responses:
        '200':
          description: Successful calculation
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BMIResponseWrapper'
              examples:
                normal:
                  summary: Normal weight
                  value:
                    data:
                      bmi: 22.86
                      category: normal
                    request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
                    timestamp: "2026-01-29T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/utils/unit-conversion:
    post:
      summary: Convert units
      description: |
        Converts values between different units within the same unit type.
        Supports weight, height, temperature, distance, and volume conversions.
      operationId: convertUnits
      tags:
        - Utility Calculations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnitConversionRequest'
            examples:
              temperature:
                summary: Celsius to Fahrenheit
                value:
                  value: 25.0
                  from_unit: C
                  to_unit: F
                  unit_type: temperature
              weight:
                summary: Kilograms to pounds
                value:
                  value: 70.0
                  from_unit: kg
                  to_unit: lb
                  unit_type: weight
              distance:
                summary: Miles to kilometers
                value:
                  value: 10.0
                  from_unit: mi
                  to_unit: km
                  unit_type: distance
      responses:
        '200':
          description: Successful conversion
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnitConversionResponseWrapper'
        '400':
          $ref: '#/components/responses/BadRequest'
        '405':
          $ref: '#/components/responses/MethodNotAllowed'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  headers:
    X-Request-ID:
      description: Unique identifier for the request
      schema:
        type: string
        example: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
    X-RateLimit-Limit:
      description: Rate limit per minute
      schema:
        type: string
        example: "100"
    X-RateLimit-Remaining:
      description: Remaining requests in current window
      schema:
        type: string
        example: "0"
    Retry-After:
      description: Seconds until rate limit resets
      schema:
        type: string
        example: "60"

  schemas:
    MathRequest:
      type: object
      required:
        - a
        - b
      properties:
        a:
          type: number
          format: double
          description: First operand
          example: 10.5
        b:
          type: number
          format: double
          description: Second operand
          example: 5.3

    MathResponse:
      type: object
      properties:
        result:
          type: number
          format: double
          description: Result of the mathematical operation
          example: 15.8

    MathResponseWrapper:
      allOf:
        - $ref: '#/components/schemas/SuccessWrapper'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/MathResponse'

    VATRequest:
      type: object
      required:
        - amount
        - rate
        - inclusive
      properties:
        amount:
          type: number
          format: double
          minimum: 0
          description: The amount to calculate VAT for
          example: 100.0
        rate:
          type: number
          format: double
          minimum: 0
          description: VAT rate as percentage (e.g., 23 for 23%)
          example: 23.0
        inclusive:
          type: boolean
          description: |
            If true, amount is gross and VAT will be extracted.
            If false, amount is net and VAT will be added.
          example: false

    VATResponse:
      type: object
      properties:
        vat_amount:
          type: number
          format: double
          description: The calculated VAT amount
          example: 23.0
        net_amount:
          type: number
          format: double
          description: The net amount (before VAT)
          example: 100.0
        gross_amount:
          type: number
          format: double
          description: The gross amount (including VAT)
          example: 123.0

    VATResponseWrapper:
      allOf:
        - $ref: '#/components/schemas/SuccessWrapper'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/VATResponse'

    CompoundInterestRequest:
      type: object
      required:
        - principal
        - rate
        - time
        - compound_frequency
      properties:
        principal:
          type: number
          format: double
          minimum: 0
          description: Initial principal amount
          example: 1000.0
        rate:
          type: number
          format: double
          minimum: 0
          description: Annual interest rate as percentage (e.g., 5 for 5%)
          example: 5.0
        time:
          type: number
          format: double
          minimum: 0
          description: Time period in years
          example: 2.0
        compound_frequency:
          type: integer
          minimum: 1
          description: Number of times interest is compounded per year (e.g., 12 for monthly)
          example: 12

    CompoundInterestResponse:
      type: object
      properties:
        final_amount:
          type: number
          format: double
          description: Total amount after interest (rounded to 2 decimals)
          example: 1104.94
        interest_earned:
          type: number
          format: double
          description: Total interest earned (rounded to 2 decimals)
          example: 104.94

    CompoundInterestResponseWrapper:
      allOf:
        - $ref: '#/components/schemas/SuccessWrapper'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/CompoundInterestResponse'

    LoanPaymentRequest:
      type: object
      required:
        - principal
        - annual_rate
        - years
        - payments_per_year
      properties:
        principal:
          type: number
          format: double
          minimum: 0
          description: Loan principal amount
          example: 200000.0
        annual_rate:
          type: number
          format: double
          minimum: 0
          description: Annual interest rate as percentage (e.g., 3.5 for 3.5%)
          example: 3.5
        years:
          type: number
          format: double
          exclusiveMinimum: 0
          description: Loan term in years
          example: 30.0
        payments_per_year:
          type: integer
          minimum: 1
          description: Number of payments per year (e.g., 12 for monthly)
          example: 12

    LoanPaymentResponse:
      type: object
      properties:
        payment_amount:
          type: number
          format: double
          description: Payment amount per period
          example: 898.09
        total_payment:
          type: number
          format: double
          description: Total amount paid over loan term
          example: 323312.18
        total_interest:
          type: number
          format: double
          description: Total interest paid over loan term
          example: 123312.18

    LoanPaymentResponseWrapper:
      allOf:
        - $ref: '#/components/schemas/SuccessWrapper'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/LoanPaymentResponse'

    BMIRequest:
      type: object
      required:
        - weight
        - weight_unit
        - height
        - height_unit
      properties:
        weight:
          type: number
          format: double
          exclusiveMinimum: 0
          description: Weight value
          example: 70.0
        weight_unit:
          type: string
          description: Weight unit (kg, g, lb, oz)
          enum: [kg, g, lb, oz]
          example: kg
        height:
          type: number
          format: double
          exclusiveMinimum: 0
          description: Height value
          example: 1.75
        height_unit:
          type: string
          description: Height unit (m, cm, ft, in)
          enum: [m, cm, ft, in]
          example: m

    BMIResponse:
      type: object
      properties:
        bmi:
          type: number
          format: double
          description: Calculated BMI value
          example: 22.86
        category:
          type: string
          description: BMI category classification
          enum:
            - underweight
            - normal
            - overweight
            - obesity_class_1
            - obesity_class_2
            - obesity_class_3
          example: normal

    BMIResponseWrapper:
      allOf:
        - $ref: '#/components/schemas/SuccessWrapper'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/BMIResponse'

    UnitConversionRequest:
      type: object
      required:
        - value
        - from_unit
        - to_unit
        - unit_type
      properties:
        value:
          type: number
          format: double
          description: Value to convert
          example: 25.0
        from_unit:
          type: string
          description: Source unit (case-insensitive for temperature)
          example: C
        to_unit:
          type: string
          description: Target unit (case-insensitive for temperature)
          example: F
        unit_type:
          type: string
          description: Type of unit conversion
          enum:
            - weight
            - height
            - temperature
            - distance
            - volume
          example: temperature

    UnitConversionResponse:
      type: object
      properties:
        result:
          type: number
          format: double
          description: Converted value (rounded to 6 decimals)
          example: 77.0
        from_unit:
          type: string
          description: Source unit
          example: C
        to_unit:
          type: string
          description: Target unit
          example: F
        unit_type:
          type: string
          description: Type of unit conversion
          example: temperature

    UnitConversionResponseWrapper:
      allOf:
        - $ref: '#/components/schemas/SuccessWrapper'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/UnitConversionResponse'

    SuccessWrapper:
      type: object
      properties:
        data:
          type: object
          description: The actual response data
        request_id:
          type: string
          description: Unique identifier for the request
          example: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the response
          example: "2026-01-29T10:30:00Z"

    ErrorResponse:
      type: object
      required:
        - code
        - message
        - request_id
        - timestamp
      properties:
        code:
          type: string
          description: Error code identifying the type of error
          enum:
            - INVALID_INPUT
            - VALIDATION_ERROR
            - DIVISION_BY_ZERO
            - METHOD_NOT_ALLOWED
            - RATE_LIMIT_EXCEEDED
            - INTERNAL_ERROR
          example: VALIDATION_ERROR
        message:
          type: string
          description: Human-readable error message
          example: Validation failed
        details:
          type: string
          description: Optional detailed error information
          example: "field 'rate' must be >= 0"
        request_id:
          type: string
          description: Unique identifier for the request
          example: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the error
          example: "2026-01-29T10:30:00Z"

  responses:
    BadRequest:
      description: Invalid request (malformed JSON, validation error, or division by zero)
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalidJSON:
              summary: Invalid JSON
              value:
                code: INVALID_INPUT
                message: Invalid request body
                details: "invalid character '}' looking for beginning of value"
                request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
                timestamp: "2026-01-29T10:30:00Z"
            validationError:
              summary: Validation error
              value:
                code: VALIDATION_ERROR
                message: Validation failed
                details: "field 'rate' must be >= 0"
                request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
                timestamp: "2026-01-29T10:30:00Z"
            divisionByZero:
              summary: Division by zero
              value:
                code: DIVISION_BY_ZERO
                message: Division by zero is not allowed
                request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
                timestamp: "2026-01-29T10:30:00Z"

    MethodNotAllowed:
      description: HTTP method not allowed for this endpoint
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: METHOD_NOT_ALLOWED
            message: Method not allowed
            details: "Only POST method is allowed"
            request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
            timestamp: "2026-01-29T10:30:00Z"

    RateLimitExceeded:
      description: Rate limit exceeded
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
        X-RateLimit-Limit:
          $ref: '#/components/headers/X-RateLimit-Limit'
        X-RateLimit-Remaining:
          $ref: '#/components/headers/X-RateLimit-Remaining'
        Retry-After:
          $ref: '#/components/headers/Retry-After'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: RATE_LIMIT_EXCEEDED
            message: Rate limit exceeded
            details: "Too many requests. Please try again in 60 seconds"
            request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
            timestamp: "2026-01-29T10:30:00Z"

    InternalError:
      description: Internal server error
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: INTERNAL_ERROR
            message: Internal server error
            details: "An unexpected error occurred"
            request_id: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
            timestamp: "2026-01-29T10:30:00Z"
